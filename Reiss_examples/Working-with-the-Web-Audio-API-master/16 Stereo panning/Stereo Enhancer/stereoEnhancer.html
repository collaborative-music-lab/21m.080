<input type='range' min=-1 max=1 value=0 step='any' id='width'>
<script>
  let context= new AudioContext()
  let source = new AudioBufferSourceNode(context,{loop:true})
  let sourceL = context.createGain()
  let sourceR = context.createGain()
  fetch('symphonic_warmup.wav')
  .then(response => response.arrayBuffer())
  .then(buffer => context.decodeAudioData(buffer))
  .then(data => source.buffer = data)
  var splitter = context.createChannelSplitter(2)
  source.connect(splitter)
  splitter.connect(sourceL,0)
  splitter.connect(sourceR,1)
  source.start()
  let Mid = new GainNode(context,{gain:Math.sqrt(0.5)})
  let Side = new GainNode(context,{gain:Math.sqrt(0.5)})
  let minusSourceR = new GainNode(context,{gain:-1})
  sourceL.connect(Mid)
  sourceR.connect(Mid)
  sourceL.connect(Side)
  sourceR.connect(minusSourceR).connect(Side)
  let gainMid = new GainNode(context)
  let gainSide = new GainNode(context)
  Mid.connect(gainMid)
  Side.connect(gainSide)
  let outputL = new GainNode(context,{gain:Math.sqrt(0.5)})
  let outputR = new GainNode(context,{gain:Math.sqrt(0.5)})
  let minusGainSide = new GainNode(context,{gain:-1})
  gainMid.connect(outputL)
  gainSide.connect(outputL)
  gainMid.connect(outputR)
  gainSide.connect(minusGainSide).connect(outputR)
  width.oninput = () => {
    context.resume()
    gainMid.gain.value = Math.cos((parseFloat(width.value)+1)*Math.PI/4)
    gainSide.gain.value = Math.sin((parseFloat(width.value)+1)*Math.PI/4)
  }
  let merger = context.createChannelMerger(2)
  outputL.connect(merger,0,0)
  outputR.connect(merger,0,1)
  merger.connect(context.destination)
</script>
