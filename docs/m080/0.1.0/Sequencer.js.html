<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sequencer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AnalogDelay_AnalogDelay.html">AnalogDelay</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Cymbal.html">Cymbal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Cymbal.html#trigger">trigger</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DatoDuo.html">DatoDuo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DatoDuo.html#initGui">initGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DatoDuo.html#setDetune">setDetune</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DrumSampler.html">DrumSampler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#initGui">initGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#loadKit">loadKit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#sequence">sequence</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#stop">stop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumSampler.html#trigger">trigger</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DrumTemplate.html">DrumTemplate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DrumTemplate.html#trigger">trigger</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MonophonicTemplate.html">MonophonicTemplate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#connect">connect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#createKnob">createKnob</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#disconnect">disconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#hideGui">hideGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#initGui">initGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#listPresets">listPresets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#loadPreset">loadPreset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#sequence">sequence</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#setADSR">setADSR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#setFilterADSR">setFilterADSR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#setSubdivision">setSubdivision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#showGui">showGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#stop">stop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#triggerAttack">triggerAttack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#triggerAttackRelease">triggerAttackRelease</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MonophonicTemplate.html#triggerRelease">triggerRelease</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Oscilloscope.html">Oscilloscope</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Sequencer.html">Sequencer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sequencer.html#setCallback">setCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sequencer.html#setGui">setGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sequencer.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Sequencer.html#stop">stop</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Spectroscope.html">Spectroscope</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="circularSequence.html">circularSequence</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="circularSequence.html#initGui">initGui</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-Theory.Chord.html">Chord</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.Chord.html#interval">interval</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.Chord.html#root">root</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.Chord.html#setChord">setChord</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.Chord.html#tones">tones</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="stepSequence.html">stepSequence</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="stepSequence.html#initGui">initGui</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="stepSequence.html#togglePlay">togglePlay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="stepSequence.html#updateGui">updateGui</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Theory.html">Theory</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.getChord">getChord</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.parseStringSequence">parseStringSequence</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.pitchNameToMidi">pitchNameToMidi</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.setProgression">setProgression</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.setProgressionRate">setProgressionRate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Theory.html#.setTonic">setTonic</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-TransferFunctionPlotter.html">TransferFunctionPlotter</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Sequencer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as Tone from 'tone'

/**
 * Class representing a Sequencer.
 */
export class Sequencer{

  /**
   * Creates a sequencer.
   * 
   * @param {object|null} [control=null] - The control object that the sequencer will manipulate (e.g., a Synth, Filter, etc.).
   * @param {number[]} [values=[]] - An array of values that the sequencer will step through.
   * @param {string} [subdivision='8n'] - The rhythmic subdivision for the sequencer (e.g., '8n' for eighth notes).
   * @param {boolean[]} [enables=[]] - An array of boolean values that enable or disable specific steps in the sequence.
   */
  constructor(control = null, values = [], subdivision = '8n', enables = []){
    //console.log('enter construct')
    this.gui = null
    this.subdivision = subdivision
    this.control = control
    this.callback = this.callback = function(i,time){
      console.log('To set custom callback: this.callback = (your function here)')
    }
    this.setCallback(this.control)
    this.values = values
    this.tempVal = values
    this.enables = enables
    this.tempenables = enables
    this.beatsPerBar = 4
    this.subdivisionsPerBeat = 4
    this.enables_index = 0
    this.values_index = 0
    this.timeGrain = this.beatsPerBar * this.subdivisionsPerBeat
    this.env = new Tone.Envelope()
    this.loop =  new Tone.Loop((time) => {
  //
      //Index calculations
        //console.log(Tone.Transport.position)
        this.time = time
        this.position = Tone.Transport.position.split(':');
        this.measure = parseInt(this.position[0]);
        this.beat = parseInt(this.position[1])
        this.sub = parseInt(this.position[2])
        this.interval = parseInt(this.subdivision)//parsed int from subdivision
        this.loop.interval = this.subdivision
        this.duration_scaler = this.timeGrain/this.interval
        this.index =(this.measure * this.timeGrain*(1/this.duration_scaler))+(this.beat*this.subdivisionsPerBeat*(1/this.duration_scaler))+Math.floor(this.sub/(this.timeGrain/this.interval))
        //console.log(this.index)
        this.temp_enables_index = this.enables_index
        this.temp_values_index = this.values_index
        this.enables_index = this.index % this.enables.length
        this.values_index = this.index % this.values.length
        
        //console.log(this.values_index)
    //
        if (this.enables.length == 0){
          this.val = this.values[this.values_index]
          //console.log(this.val)
        }

        else if (this.enables[this.enables_index]){
          //console.log(this.values[this.values_index])
          this.val = this.values[this.values_index]
          //console.log(this.val)
          
        }
        else {
          //console.log(0)
          this.val = 0
        }

        this.callback(this.values_index, time)

       if(this.interface !== undefined){
        this.interface.updateGui(this.values_index, this.enables_index)

      }
                
    //
    }, this.subdivision);
  //console.log("sequencer ready")
  }
  /**
   * Sets the GUI interface for the sequencer.
   * 
   * @param {string} name - The name of the GUI interface to use (e.g., 'stepSequence', 'circularSequence').
   * @param {object} gui - The GUI object.
   */
  setGui(name, gui){
    if(name === "stepSequence") this.interface = new stepSequence(this,gui)
    else if (name === "circularSequence") this.interface = new circularSequence(this, gui)
  }

  /**
   * Starts the sequencer loop and the Tone.js Transport.
   */
  start() {
    // Start the loop and the transport
    this.loop.start(0);
    Tone.Transport.start();
  }

  /**
   * Stops the loop
   */
  stop() {
    this.loop.stop()
  }

  /**
   * Sets the callback function that will be triggered on each step of the sequence.
   * 
   * @param {object|function} control - The control object or function to use as the callback.
   */
  setCallback(control) {
    if (control == null) {
      return
    }

    else if (control.name === 'Synth'){
      //console.log(true)
      this.callback = function(i, time){
        if (this.val) {
          //console.log(this.control)
          //console.log(this.val)
          this.control.triggerAttackRelease(this.val,100,.01,time)
        }
      }
    }

    else if (control.name === 'Drum'){
      this.callback = function(){
      
      }
    }

    else if (control.name === 'Filter'){
      this.callback = function(){
        this.control.frequency.value = this.val
      }
    }

    else if (control.name === 'Multiply'){
      this.callback = function(){
        this.control.factor.value = this.val
      }
    }

    else if (control.name === 'Envelope'){
      this.callback = function(){
        this.control.decay = this.val
        this.control.release = this.val*1.2
      }
    }

    else if (control.name === 'Oscillator'){
      //console.log(true)
      this.callback = function(){
        if (this.val) {
          this.control.frequency.setValueAtTime(Tone.Midi(this.val).toFrequency(), this.time)
          this.env.triggerAttackRelease(this.subdivision, this.time)
        }
      }
    }

    else if (typeof control === 'function'){
      this.callback = control
    }
  }
} 
// so the idea is make methods that check to see if you should execute a sequence for midi, delay, cutoff
// frequencies, scale degrees, etc., and return a true or false value. Given that true or false the loop
// should execute different things. So the midi method should be

/**
 * Class representing a step sequencer GUI with a linear layout
 */
class stepSequence{
  /**
   * Creates a step sequencer interface.
   * 
   * @param {object} target - The target sequencer object that this GUI will control.
   * @param {object} gui - The GUI object used to create controls.
   */
  constructor(target, gui){
    this.gui = gui
    this.target = target
    this.initGui()
    this.prevVal = 0
    this.prevEnable = 0
  }
  /**
   * Initializes the GUI controls for the step sequencer.
   * 
   * @param {number} [x=10] - The x-coordinate for the start of the GUI layout.
   * @param {number} [y=10] - The y-coordinate for the start of the GUI layout.
   */
  initGui( x = 10, y = 10) {
    //make your sequencer.gui here
    this.x = x
    this.y = y
    this.enables_array = []
    this.values_array = []

    for( let i=0; i&lt;this.target.enables.length; i++){
      this.enables_array.push(this.createToggle('En'+(i+1).toString(), 10*i, 80, 0.5, [200,50,0],  x => this.target.enables[i] = x))
      this.enables_array[i].set(1)
    }
    
    for( let i=0; i&lt;this.target.values.length; i++){
      this.values_array.push(this.createKnob((i+1), 10*i, 60, 0, 127, 1,  [200,50,0],  x => this.target.values[i] = Math.floor(x)))
    }
    this.playButton = this.createToggle('Pause/Play', 50, 10, 1, [200,50,0], x => this.togglePlay(x))
    this.playButton.set(1)

    this.playText = this.gui.Text({label:"play", x:50,y:20})
  }

  /**
   * Updates the GUI to reflect the current state of the sequencer.
   * Called in the sequencer's loop.
   * 
   * @param {number} values - The current index of the values array.
   * @param {number} enables - The current index of the enables array.
   */
  updateGui(values, enables){
    this.values_array[values].accentColor = [0, 250, 0]
    this.values_array[this.prevVal].accentColor = [0, 0, 200]
    this.prevVal = values

    this.enables_array[enables].accentColor = [0, 250, 0]
    this.enables_array[this.prevEnable].accentColor = [0, 0, 200]
    this.prevEnable = enables

  }

  createKnob(_label, _x, _y, _min, _max, _size, _accentColor, callback) {
    //console.log(_label)
    return this.gui.Knob({
      label:_label, min:_min, max:_max, size:_size, accentColor:_accentColor,
      x: _x + this.x, y: _y + this.y,
      callback: callback,
      curve: 1, // Adjust as needed
      border: 4, // Adjust as needed
      showLabel: 0, showValue: 0
    });
  }

  createToggle(_label, _x, _y, _size, _accentColor, callback) {
    //console.log(_label)
    return this.gui.Toggle({
      label:_label, size:_size, accentColor:_accentColor,
      x: _x + this.x, y: _y + this.y,
      callback: callback,
      showLabel: 1, showValue: 1, // Assuming these are common settings
      border: 20, // Adjust as needed
      showLabel: 0, showValue: 0
    });
  }
  /**
   * Toggles the playback state of the sequencer.
   * 
   * @param {boolean} x - If true, starts the sequencer; otherwise, stops it.
   */
  togglePlay(x){
    if (x){
      return this.target.start()
    }
    return this.target.stop()
  }
}

/**
 * Class representing a step sequencer GUI with a circular layout
 */
class circularSequence extends stepSequence{
  /**
   * Creates a circular step sequencer interface.
   * 
   * @param {object} target - The target sequencer object that this GUI will control.
   * @param {object} gui - The GUI object used to create controls.
   */
  constructor(target, gui){
    super(target, gui)
  }

  /**
   * Initializes the GUI controls for the step sequencer.
   * 
   * @param {number} [x=10] - The x-coordinate for the start of the GUI layout.
   * @param {number} [y=10] - The y-coordinate for the start of the GUI layout.
   */
  initGui(x = 25, y = 25) {
    this.x = x;
    this.y = y;
    this.enables_array = [];
    this.values_array = [];

    const centerX = this.x;
    const centerY = this.y;
    const radius = 100; // Adjust the radius as needed
    const knobRadius = radius + 80; // Knobs on the outside

    const numElements = Math.max(this.target.enables.length, this.target.values.length);
    const angleStep = 2*Math.PI / numElements;

    // Create buttons in the inner circle
    for (let i = 0; i &lt; this.target.enables.length; i++) {
        const angle = i * angleStep;
        const buttonX = centerX + radius * Math.cos(angle)/10;
        const buttonY = centerY + radius * Math.sin(angle)/5;
        
        this.enables_array.push(this.createToggle('En'+(i+1).toString(), buttonX, buttonY, 0.3, [200, 50, 0], x => this.target.enables[i] = x));
        this.enables_array[i].set(1);
    }

    // Create knobs in the outer circle
    for (let i = 0; i &lt; this.target.values.length; i++) {
        const angle = i * angleStep;
        const knobX = centerX + knobRadius * Math.cos(angle)/10;
        const knobY = centerY + knobRadius * Math.sin(angle)/5;

        this.values_array.push(this.createKnob((i + 1), knobX, knobY, 24, 72, 0.8, [200, 50, 0], x => this.target.values[i] = Math.floor(x)));
    }

    // Place the play button in the center
    this.playButton = this.createToggle('Pause/Play', centerX, centerY, 1, [200, 50, 0], x => this.togglePlay(x));
    this.playButton.set(1)
    this.playText = this.gui.Text({label:"play", x:50,y:50, border:1})
  }
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Thu Aug 01 2024 23:11:16 GMT-0400 (Eastern Daylight Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
